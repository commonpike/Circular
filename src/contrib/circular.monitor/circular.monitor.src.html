<html>
	<head>
		<title>Circular.monitor</title>
		<script src="../../../vendor/node_modules/jquery/dist/jquery.min.js"></script>
		<script src="../../../vendor/node_modules/esprima/esprima.js"></script>
		<script src="../../../vendor/node_modules/observe-js/src/observe.js"></script>

		<script src="../../core/circular.core.00/circular.core.js"></script>
		<script src="../../core/circular.core.01-log/circular.log.js"></script>
		<script src="../../core/circular.core.02-debug/circular.debug.js"></script>
		<script src="../../core/circular.core.03-queue/circular.queue.js"></script>
		<script src="../../core/circular.core.04-context/circular.context.js"></script>
		<script src="../../core/circular.core.05-root/circular.root.js"></script>
		<script src="../../core/circular.core.06-content/circular.content.js"></script>
		<script src="../../core/circular.core.07-parser/circular.parser.js"></script>
		<script src="../../core/circular.core.08-registry/circular.registry.js"></script>
		<script src="../../core/circular.core.09-engine/circular.engine.js"></script>
		<script src="../../core/circular.core.10-watchdog/circular.watchdog.js"></script>
		
		<script src="../../base/circular.base.01-hide/circular.hide.js"></script>
		<script src="../../base/circular.base.02-template/circular.template.js"></script>
		<script src="../../base/circular.base.03-loop/circular.loop.js"></script>
		
		<script src="circular.monitor.js"></script>
		<style type="text/css">
			body { font-family:arial, sans-serif; }
			
			

			#cc-monitor	{ 
				position:fixed; top:1em; right:1em; 
				padding:0; margin:0; list-style-type:none;
				width:350px; 
				background-color:black;
				color:#ddd;
				z-index:9999;
				font-family: sans-serif;
				font-size:12px;
				line-height:20px;
			}
			#cc-monitor [onclick] {
				cursor:pointer;
			}
				#cc-monitor li {
					clear:both;
					border-top:1px solid #999;
				}
					
					#cc-monitor li span.value {
						display:block;
						padding-left:1em;
						min-width:1em;
						overflow:hidden;
						white-space:nowrap;
						text-overflow:ellipsis;
					}
					#cc-monitor li span.label {
						float:left;
						width:95px;
						padding-left:5px;
					}
						#cc-monitor li li li span.label {
							width:90px;
							padding-left:10px;
						}
					
					#cc-monitor li span.buttons {
						float:right;
						width:60px;
						padding-right:5px;
						font-size:larger;
						text-align:right;
					}
					
					#cc-monitor li span.opener {
						cursor:pointer;
					}
							
							
					#cc-monitor  ul {
						background-color:rgba(255,255,255,.2);
						clear:both;
						padding:0; margin:0; list-style-type:none;
						overflow:hidden;
						max-height:0;
						transition:max-height 1s;
					}
						#cc-monitor  ul.open {
							max-height:500px;
							overflow:auto;
						}
							
			#cc-monitor i.icon {
				display: inline-block;
				position:relative;
    		width: 16px;
    		height: 16px;
    		line-height: 16px;
		    top: 2px;
    	}
				#cc-monitor i.icon:before, i.icon:after {
					content: "";
					position: absolute;
					top: 50%;
					left: 0;
					margin: -8px 0 0;
					background: #000;
				}
					#cc-monitor .icon.play:before {
							width:16px;
							height:16px;
							/* css3 */
							-webkit-border-radius:16px;
							-moz-border-radius:16px;
							border-radius:16px;
					}
					#cc-monitor .icon.play:after {
							left:7px;
							border:4px solid transparent;
							border-left-color:#fff;
							margin-top:-4px;
							background:transparent;
					}
					#cc-monitor .icon.pause:before {
						width:16px;
						height:16px;
						/* css3 */
						-webkit-border-radius:16px;
						-moz-border-radius:16px;
						border-radius:16px;
					}
					
					#cc-monitor .icon.pause:after {
							left:5px;
							width:2px;
							height:8px;
							border:2px solid #fff;
							border-width:0 2px;
							margin-top:-4px;
							background:transparent;
					}
					#cc-monitor .icon.stop:before {
							width:16px;
							height:16px;
							/* css3 */
							-webkit-border-radius:16px;
							-moz-border-radius:16px;
							border-radius:16px;
					}
					
					#cc-monitor .icon.stop:after {
							left:5px;
							width:6px;
							height:6px;
							margin-top:-3px;
							background:#fff;
					}
					#cc-monitor .icon.kill:before {
							left:3px;
							width:10px;
							height:10px;
							border:3px solid #C00000;
							margin-top:-8px;
							background:transparent;
							/* css3 */
							-webkit-border-radius:16px;
							-moz-border-radius:16px;
							border-radius:16px;
					}
					
					#cc-monitor .icon.kill:after {
							left:6px;
							width:11px;
							height:3px;
							margin-top:-2px;
							background:#C00000;
							/* css3 */
							-webkit-transform:rotate(-45deg);
							-moz-transform:rotate(-45deg);
							-ms-transform:rotate(-45deg);
							-o-transform:rotate(-45deg);
							transform:rotate(-45deg);
					}
					#cc-monitor .icon.search:before {
							width:6px;
							height:6px;
							border:3px solid #fff;
							background:transparent;
							/* css3 */
							-webkit-border-radius:12px;
							-moz-border-radius:12px;
							border-radius:12px;
					}
					
					#cc-monitor .icon.search:after {
							left:10px;
							width:3px;
							height:7px;
							margin-top:0;
							/* css3 */
							-webkit-transform:rotate(-45deg);
							-moz-transform:rotate(-45deg);
							-ms-transform:rotate(-45deg);
							-o-transform:rotate(-45deg);
							transform:rotate(-45deg);
							background-color:#fff;
					}
					#cc-monitor .icon.step {
						border-radius:16px;
						background-color:black;
					}
					#cc-monitor .icon.step:before {
							left:10px;
							width:1px;
							height:8px;
							margin-top:-4px;
							background-color:#fff;
					}
					
					#cc-monitor .icon.step:after {
							left:5px;
							border:4px solid transparent;
							border-left-color:#fff;
							margin-top:-4px;
							background:transparent;
					}

		</style>
	</head>
	<body cc-root>
		<div cc-content="{{document.title}}">monitored</div> 
		<div cc-monitor>
			<ul id="cc-monitor">
				<li>
					<span class="label">Circular</span>
					<span class="buttons">
						<i class="icon kill" onclick="Circular.die(); $('#cc-monitor-dead').text('dead')"></i>
					</span>
					<span id="cc-monitor-dead" class="value" cc-content="{{!@dead?'alive':'dead'}}"></span>
					<ul id="cc-monitor-modules" class="open">
						<li>
							<span class="label">@monitor</span>
							<span class="buttons">
								
								<i cc-hide="{{@monitor.paused}}" class="icon pause" onclick="Circular.monitor.stop()"></i>
								<i cc-show="{{@monitor.paused}}" class="icon step" onclick="Circular.monitor.step()"></i>
								<i cc-show="{{@monitor.paused}}" class="icon play" onclick="Circular.monitor.start()"></i>
							</span>
							<span class="value">{{@monitor.counter}}</span>
						</li>	
						<li id="cc-monitor-queue">
							<span class="label">@queue</span>
							<span class="buttons">
								<i cc-hide="{{@queue.paused}}" class="icon pause" onclick="Circular.queue.pause(true)"></i>
								<i cc-show="{{@queue.paused}}" class="icon step" onclick="Circular.queue.next()"></i>
								<i cc-show="{{@queue.paused}}" class="icon play" onclick="Circular.queue.pause(false)"></i>
							</span>
							<span class="value">{{@monitor.snapshot.queue.added}}:{{@monitor.snapshot.queue.handled}}:{{@monitor.snapshot.queue.todo.length}}</span>
							
							<ul>
								<li>
									<span class="label">#added</span>
									<span class="value">{{@monitor.snapshot.queue.added}}</span>
								</li>
								<li>
									<span class="label">#handled</span>
									<span class="value">{{@monitor.snapshot.queue.handled}}</span>
								</li>
								<li>
									<span class="label">#todo.length</span>
									<span class="value">{{@monitor.snapshot.queue.todo.length}}</span>
								</li>
							</ul>
						</li>
						<li id="cc-monitor-engine">
							<span class="label">@engine</span>
							<span class="value">{{@monitor.snapshot.engine.counter}}</span>
							<ul>
								<li>
									<span class="label">#counter</span>
									<span class="value">{{@monitor.snapshot.engine.counter}}</span>
								</li>
							</ul>
						</li>
						<li id="cc-monitor-registry">
							<span class="label">@registry</span>
							<span class="buttons">
								<i class="icon search"></i>
							</span>
							<span class="value">{{@monitor.snapshot.registry.counter}}</span>
							<ul>
								<li>
									<span class="label">#counter</span>
									<span class="value">{{@monitor.snapshot.registry.counter}}</span>
								</li>
							</ul>
						</li>
						<li id="cc-monitor-watchdog">
							<span class="label">@watchdog</span>
							<span class="value">{{@monitor.snapshot.watchdog.countdobs}}:{{@monitor.snapshot.watchdog.paths.length}}:{{@monitor.snapshot.watchdog.eventsin.records.length}}</span>
							<ul>
								<li>
									<span class="label">#domobservers</span>
									<span class="value">{{@monitor.snapshot.watchdog.countdobs}}</span>
								</li>
								<li>
									<span class="label">#pathobservers</span>
									<span class="value">{{@monitor.snapshot.watchdog.paths.length}}</span>
									<ul cc-loop="{{@monitor.snapshot.watchdog.paths}}">
										<li>
											<span class="value" cc-content="{{#this}} x"></span>
										</li>
									</ul>
								</li>
								<li>
									<span class="label">#events</span>
									<span class="value">{{@monitor.snapshot.watchdog.eventsin.records.length}}</span>
									<!--ul cc-loop="{{@monitor.snapshot.watchdog.eventsin.records}}">
										<li>
											<span class="label">{{@monitor.snapshot.watchdog.nodes[@loop.index].nodeName.toLowerCase()}}</span>
											<span class="value">{{#this.length}}</span>
										
											<ul cc-loop="{[#this]}" class="open">
												<li>
													<span class="label">x{[#type]}x</span>
													<span class="value">{[#target]}:{[#flag]}</span>
												</li>
											</ul>
										</li>
									</ul-->
								</li>
							</ul>
						</li>

					</ul>
				</li>
			</ul>
		</div>
		<script>
			$('#cc-monitor>li').on('click touchstart',function(ev) {
				$('#cc-monitor-modules').toggleClass('open');				
			});
			$('#cc-monitor>li ul li').each(function() {
				if ($('ul',this).size()) {
					var par = this;
					$('>.label',this).on('click touchstart',function(ev) {
						ev.stopPropagation();
						$('>ul',par).toggleClass('open');				
					}).addClass('opener');
				} 
				$(this).on('click touchstart',function(ev) {
					ev.stopPropagation();
				});
				$('>.buttons',this).on('click touchstart',function(ev) {
					ev.stopPropagation();
				});
			});
		</script>
	</body>
</html>